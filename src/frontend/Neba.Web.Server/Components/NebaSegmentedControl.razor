@* iOS-style segmented control component *@

<div role="tablist"
     class="inline-flex bg-gray-100 rounded-lg p-1 gap-1 @CssClass"
     @onkeydown="HandleKeyDown">
    @foreach (var option in Options)
    {
        var isSelected = option.Value == SelectedValue;
        var buttonClass = isSelected
            ? "px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 bg-white shadow-sm text-[var(--neba-blue-700)] font-semibold"
            : "px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 text-gray-600 hover:text-gray-900";

        <button type="button"
                role="tab"
                aria-selected="@isSelected"
                class="@buttonClass"
                @onclick="() => HandleSelection(option.Value)">
            @option.Label
        </button>
    }
</div>

@code {
    /// <summary>
    /// The list of options to display in the segmented control.
    /// </summary>
    [Parameter, EditorRequired]
    public List<SegmentedControlOption> Options { get; set; } = new();

    /// <summary>
    /// The currently selected option value.
    /// </summary>
    [Parameter, EditorRequired]
    public string SelectedValue { get; set; } = string.Empty;

    /// <summary>
    /// Callback invoked when the selected value changes.
    /// </summary>
    [Parameter, EditorRequired]
    public EventCallback<string> OnValueChanged { get; set; }

    /// <summary>
    /// Optional CSS class to apply to the container.
    /// </summary>
    [Parameter]
    public string? CssClass { get; set; }

    private async Task HandleSelection(string value)
    {
        if (value != SelectedValue)
        {
            await OnValueChanged.InvokeAsync(value);
        }
    }

    private async Task HandleKeyDown(KeyboardEventArgs e)
    {
        // Support arrow key navigation
        if (e.Key == "ArrowLeft" || e.Key == "ArrowRight")
        {
            var currentIndex = Options.FindIndex(o => o.Value == SelectedValue);
            var newIndex = e.Key == "ArrowLeft"
                ? Math.Max(0, currentIndex - 1)
                : Math.Min(Options.Count - 1, currentIndex + 1);

            if (newIndex != currentIndex)
            {
                await HandleSelection(Options[newIndex].Value);
            }
        }
    }
}
