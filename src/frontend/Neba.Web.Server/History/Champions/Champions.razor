@page "/history/champions"
@rendermode @(new InteractiveServerRenderMode(prerender: false))

@inject INebaApi NebaApi

<PageTitle>Champions - NEBA</PageTitle>

<div class="space-y-6">
    <!-- Page Header -->
    <div>
        <h1 class="text-3xl font-bold text-gray-900">Champions</h1>
        <p class="mt-1 text-sm text-gray-600">NEBA tournament title leaders throughout history</p>
    </div>

    <!-- Error Alert -->
    @if (!string.IsNullOrWhiteSpace(errorMessage))
    {
        <NebaAlert Severity="NotifySeverity.Error"
                   Title="Error Loading Champions"
                   Message="@errorMessage"
                   Dismissible="true"
                   OnDismiss="@(() => errorMessage = null)" />
    }

    <!-- Loading Indicator -->
    <NebaLoadingIndicator IsVisible="@isLoading"
                          Text="Loading champions..."
                          Scope="LoadingIndicatorScope.Page" />

    <!-- Cards Layout -->
    @if (champions.Count > 0)
    {
        <CardGridLayout Champions="champions" />
    }
</div>

@code {
    private List<BowlerTitleCountViewModel> champions = new();
    private string? errorMessage;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            await Task.Delay(1500);
            Refit.ApiResponse<Contracts.CollectionResponse<Contracts.History.Champions.GetBowlerTitleCountsResponse>> response = await NebaApi.GetBowlerTitleCountsAsync();

            if (!response.IsSuccessStatusCode)
            {
                errorMessage = $"Failed to load champions data. Status: {response.StatusCode}";
                return;
            }

            champions = response.Content?.Items.Select(getBowlerTitleCountsResponse => getBowlerTitleCountsResponse.ToViewModel()).ToList() ?? [];
        }
        finally
        {
            isLoading = false;
        }
    }
}
