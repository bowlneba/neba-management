@page "/history/champions"
@rendermode @(new InteractiveServerRenderMode(prerender: false))

@inject INebaApi NebaApi

<PageTitle>Champions - NEBA</PageTitle>

<div class="space-y-6">
    <!-- Page Header -->
    <div>
        <h1 class="text-3xl font-bold text-gray-900">Champions</h1>
        <p class="mt-1 text-sm text-gray-600">NEBA tournament title leaders throughout history</p>
    </div>

    <!-- Loading Indicator -->
    <NebaLoadingIndicator IsVisible="@(champions.Count == 0)"
                          Text="Loading champions..."
                          Scope="LoadingIndicatorScope.Page" />

    <!-- Cards Layout -->
    @if (champions.Count > 0)
    {
        <CardGridLayout Champions="champions" />
    }
</div>

@code {
    private List<BowlerTitleCountViewModel> champions = new();

    protected override async Task OnInitializedAsync()
    {
        // Simulate streaming data load
        await Task.Delay(1000);

        Refit.ApiResponse<Contracts.CollectionResponse<Contracts.History.Champions.GetBowlerTitleCountsResponse>> response = await NebaApi.GetBowlerTitleCountsAsync();

        if (!response.IsSuccessStatusCode)
        {
            // handle error w/ alert

            return;
        }

        champions = response.Content?.Items.Select(getBowlerTitleCountsResponse => getBowlerTitleCountsResponse.ToViewModel()).ToList() ?? [];
    }
}
